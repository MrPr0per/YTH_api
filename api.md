- общая информация для всех запросов:
	- про jwt токены
		- все jwt токены будут иметь одну структуру:
			- ```js
				{
					"ver": str, // (version)      версия токена (чтобы можно было потом расширять эту структуру)
					"iat": int, // (issued at)    время выдачи (в Unix Time)
					"exp": int, // (expired)      время истечения (в Unix Time)
					"jti": str, // (twt token id) id токена (чтобы можно было его отзывать через сохранение jti в блеклист, пока он не истечет)
					"roles": list[str], //        роли (для проверки доступов)
					"context": { //               доп поля, которые зависят от ролей
						...
					}
				}
			  ```
	- про роли и доступы
		- пользователь подтверждает свои роли через jwt токен
		- какие роли будут и какие у них будут доступы:
			- `<без роли, токен вообще не нужен и не проверяется>`
				- просмотр постов, евентов, курсов
				- вход в аккаунт
			- `with_confirmed_email` с `email:str` в контексте
				- регистрация
				- восстановление аккаунта
			- `logged_in` с `sub:str` в контексте
				- `sub` (subject) - id пользователя
				- просмотр, удаление, редактирование, выход из своего аккаунта
				- загрузка, изменение, удаление документов
				- смена пароля
					- %% В будущем можно дополнительно проверять доступ к почте перед сменой пароля через требование роли with_confirmed_email %%
			- `student` (является `logged_in_user`)
				- подача заявки на эксперта
				- запись и раз-запись на евенты и курсы
			- `admin` (является `logged_in_user`)
				- создание, редактирование, удаление постов (только своих)
					- %% (в будущем можно выделить это в отдельную роль редактора) %%
					- %% (так же на будущее можно добавить админу право выдавать и отзывать роли (кроме роли админ)) %%
				- создание, редактирование, удаление евентов (всех)
				- создание, редактирование, удаление курсов (всех)
				- принятие/отклонение заявок на эксперта
			- `superadmin` (является `admin`)
				- выдача и отзыв роли `admin`
		- как выдаются
			- Пользователи (student-ы) - получают свою роль при регистрации
			- Админов назначает суперадмин из пользователей
			- Суперадмина назначаем мы вручную
	- про access/refresh токены
		- при регистрации и входе будут создаваться 2 токена: access_token и refresh_token
		- про эту схему с двумя токенами:
			- https://habr.com/ru/companies/Voximplant/articles/323160/
		- но если кратко:
			- access токен короткоживущий, его нужно будет посылать с каждым запросом в заголовке Authorization
			- refresh - долгоживущий, хранится в HttpOnly+Secure куках (к нему нет доступа из js)
			- если access истечет, нужно сделать запрос на /refresh, чтобы обновить оба токена
			- если refresh истечет, нужно будет снова залогиниться по паролю
		- access токен - это jwt с выше описанной структурой
		- refresh токен - это просто случайная строка
		- время жизни у них:
			- у access - около 10 мин
			- у refresh - около 30 дней
		- Как передаются:
			- refresh автоматически кладется в `HttpOnly; Secure; SameSite=Strict cookie`
			- access передается в теле, его нужно хранить только в памяти (не класть в куки/хранилища) (для защиты от xss) и потом класть в Authorization заголовок
	- про ошибки
		- формат
			- в теле ответа 4xx (и ==возможно== 5xx) всегда будет как минимум 2 поля: код ошибки и сообщение для отладки (которое нельзя показывать пользователям в сыром виде): `{"error_code": "urn:error:tooManyRequests", "message": "..."}`
			- прописывать конкретные коды ошибок мы будем по мере разработки, заранее сказать какие могут возникать ошибки - тяжело
		- общие ошибки
			- для любых запросов:
				- 404
					- если указанного эндпоинта нет
				- 405 Method Not Allowed
					- если серверу метод известен, но указанный в запросе метод не поддерживаем для ресурса. Например, использование POST/PUT для ресурса, доступного только на чтение через GET
				- 429 Too Many Request
					- Штобы не флудили!
				- 500
					- при ошибках сервака
			- для любых запросов с телом/query-параметрами/параметрами в пути
				- 400 Bad Request
					- Если параметры в неверном формате
				- 404
					- Если ресурса по какому то из переданных айдишников нет
				- 422 Unprocessable Entity
					- Если параметры корректны синтаксически, но некорректны семантически
			- для любых запросов после входа (если не сказано обратного)
				- 401 Unauthorized
					- если access или refresh токен истек или вовсе не был предоставлен
			- для любых запросов с ограниченным доступом
				- 403 Forbidden
					- нет прав
	- про ответы:
		- все возможные ответы:
			- (не закомментированные будут прописаны явно в каждом случае, а закомментированные уже были описаны выше в "общие ошибки")
			- ```js
				2xx
				    200 Ok
				    201 Created
				    204 No Content
				4xx
				    // 400 Bad Request
				    // 401 Unauthorized
				    // 403 Forbidden
				    // 404 Not found
				    // 405 Method Not Allowed
				    409 Conflict
				    // 410 Gone
				    422 Unprocessable Entity
				    // 429 Too Many Reques
				5xx
				    // 500 Internal Server Error
			  ```
	- общие заголовки для любых запросов после входа (если не сказано обратного)
		- `Authorization: Bearer {access_token}`
	- серверные заголовки:
		- Strict-Transport-Security
			- Гарантирует, что браузер всегда использует HTTPS
		- Content-Security-Policy
			- Ограничивает, какие скрипты, стили, изображения можно загружать и выполнять
		- X-Frame-Options
			- Запрещает отображать твой сайт в чужом `iframe`
		- X-Content-Type-Options
			- защита от MIME-sniff атак
	- про пагинацию
		- у любого запроса списка ресурсов будет одинаковая пагинация:
		- ?cursor={before/after:{id}}&take={count}&orderBy={fieldName}:{asc/desc} (GET)
			- query параметры пагинации:
				- `cursor: (direction: str, id:Id)?`
					- какой блок значений брать
					- `?cursor=after:{id}` - будет брать `count` элементов ПОСЛЕ элемента с данным id НЕ включительно
					- `?cursor=before:{id}` - будет брать `count` элементов ПЕРЕД элементом с данным id НЕ включительно
					- по умолчанию берет первые `count` элементов
				- `take: int`
					- сколько элементов взять
				- `orderBy: {fieldName: str, order: str}?`
					- поле и направления сортировки
					- строки с одинаковым значением выбранного поля сортируются по id
					- по умолчанию сортирует только по id
					- Пример: `?orderby=name:asc`
		- также у любого такого запроса будут ответы одного формата
			- ответы:
				- 200 -> `PaginationPage<T>` (см "объекты/типы")
				- 400 - некорректный формат, например
					- если take не указан
					- если take отрицательное
					- если у orderBy некорректный формат
					- если в orderBy указано несуществующее поле или поле, по которому невозможно сортироваться (например поле типа список)
				- 404 - если id из cursor не существует
				- 422 - если формат верный, но значения некорректны, например
					- take отрицательный

	- ~~про ссылки на ресурсы~~ (тут лучше всегда смотреть индивидуально)
		- пример:
			- `Course`
				- ```js
					{
						"id": Id,
						// ...
						"tags": [Id(Tag)],
					}
				  ```
		- если один ресурс ссылается на другой через Id в своем содержании, то работа с ним будет выглядеть так:
		- create - на месте этих ресурсов - айдишники
		- read - будет дополнительный параметр
			- ?expand={isExpand: bool}
				- если True - заменяет id всех используемых ресурсов на объекты
				- по умолчанию True
			- Однако будет он только если ресурсы по ссылкам будут не большие и не будут содержать ссылок на другие ресурсы
				- в противном случае хз как лучше реализовать, нужно смотреть индивидуально
	- про JSONPATCH
		- https://jsonpatch.com/
		- далее, если в теле будет приниматься JSONPATCH, рядом будет указано к какому объекту он будет применяться

- шаблон:
	- <ресурс>
		- <ендпоинт> (<метод>) - <описание>
			- <доп-комментарии (если есть)>
			- доступ:
				- <для кого доступен этот метод>
			- эффекты (если есть)
				- <что делает этот эндпоинт, кроме взаимодействия с ресурсом в бд>
			- тело запроса (если есть)
				- ...
			- query параметры (если есть)
				- ...
			- ответы:
				- 1. (ненужное зачеркнуто)
					- ок - 2xx -> <тело>
					- ошибки параметров (<параметры>)
					    - 400 - <параметры>
					    - 404 - <параметры>
					    - 422 - <параметры>
					- логические ошибки - 409
					- ошибки входа/доступа - 401/403
					- ошибки пагинации - 400/404/422
					- общие - 404/405/429/500
				- 2.
					- ок - 2xx -> тело
					- ошибки параметров (каких)
						- 400
						- 404
						- 422
					- логические ошибки - 409
					- ошибки входа/доступа - 401/403
					- ошибки пагинации - 400/404/422
					- общие - 404/405/429/500
				- 3.
					- 404
					- 409
					- 422
					- 400
					- 401/403 - ошибки входа/доступа
					- 400/404/422 - пагинация
					- 404/405/429/500 - общие
			- (тут ошибки могут повторяться, например 404 в блоке про пагинацию,  сама по себе и в блоке с общими. Это означает, что у ошибки разные причины появления - из за пагинационных параметров, из за остальных параметров или из за то отсутствия эндпоинта)



- объекты/типы
	- `Id`
		- у нас id - это uuid строка
		- `Id(T)` означает, что это id ресурса T
	- `IsoDateTime`
		- строка с датой и временем в формате iso
	- `PaginationPage<T>`
		- ```js
			{
				"total": int,  // общее число элементов (потенциально может
								// измениться по мере обхода списка ресурсов)
				"actualTake": int, // сколько реально удалось получить
				"items": [T], // T - тип запрашиваемого ресурса
			}
			```
	- `Activity`
		- одно из
			- Cource
			- Event
	- `PostStatus`
		- одно из
			- Posted
			- Hidden
	- `ExpertApplicationStatus`
		- одно из
			- Created
			- Sent
			- AcceptedForReview
			- Reviewed
	- `ExpertApplicationActionType`
		- возможные экшоны и их доп.поля (т.е. `action: other`):
			- ```js
				"Created": null
				"Sent": null
				"CanceledSending": null
				"Accepted": {
					AcceptedBy: Id(User),
					message: str,
				}
				"СanceledAcceptance": null
				"Reviewed": {
					isApproved: Bool,
					resolutionMessage: str?, // если принято, то сообщение писать незачем, оно должно быть null
				}
				"СanceledReview": null
			  ```
	- `EventType`
		- одно из
			- Offline
			- Online
	- `UserRole`
		- одно из
		    - Student
		    - Expert
		    - Admin
		    - SuperAdmin

- ресурсы
	- `User`
		- ```js
			{
				"id": Id, // управляется сервером
				"username": str,
				"role": UserRole // управляется сервером, по умолчанию Student
			}
		  ```
	- `Course`
		- ```js
			{
				"id": Id, // управляется сервером
				"сreatedAt": IsoDateTime, // управляется сервером
				"name": str,
				"description": str,
				"link": str,
				// "category": Id(Category),
				// "tags": [Id(Tag)],
			}
		  ```
	- `Event`
		- ```js
			{
				"id": Id, // управляется сервером
				"сreatedAt": IsoDateTime, // управляется сервером
				"name": str,
				"description": str,
				"date": IsoDateTime,
				"adress": str?,
				"type": EventType,
			}
		  ```
	- `Category`
		- ```js
			{
				"id": Id, // управляется сервером
				"name": str
			}
		  ```
	- `Tag`
		- ```js
			{
				"id": Id, // управляется сервером
				"name": str
			}
		  ```
	- `EventRegistration`
		- регистрация на евент
		- ```js
			{
				"id": Id, // управляется сервером
				"сreatedAt": IsoDateTime, // управляется сервером
				"user": Id(User),
				"event": Id(Event)
			}
		  ```
	- `CourseRegistration`
		- регистрация на курс
		- ```js
			{
				"id": Id, // управляется сервером
				"сreatedAt": IsoDateTime, // управляется сервером
				"user": Id(User),
				"course": Id(Course)
			}
		  ```
	- `Post`
		- ```js
			{
				id: Id, // управляется сервером
				сreatedAt: IsoDateTime, // управляется сервером
				author: Id(User), // управляется сервером
			    // category: Id(Category),
			    title: str, // < 512 символов
			    // shortDescription: str,
			    description: str,
			    status: PostStatus, // по умолчанию Posted
			    // tag: Id(PostTag)
			}
		  ```
	- `Notification`
		- неизменяемые вручную (изменяется только is_read и тот только в одну сторону)
		- создается только сервером
		- ```js
			{
				id: Id, // управляется сервером
				createdAt: IsoDateTime, // управляется сервером
				recipient: Id(User),
				title: str,
				content: str,
				is_read: bool, // управляется сервером, по умолчанию false
			}
		  ```
	- `ExpertApplication`
		- ```js
			{
				// 1й этап: создание
				id: Id, // управляется сервером
				status: ExpertApplicationStatus // управляется сервером
				createdBy: Id(User) // управляется сервером
				message: str,
				
				// 2й этап: отправка, поля не добавляются
				
				// 3й этап: взятие на рассмотрение, добавляются поля:
				acceptedBy: Id(User)?, // управляется сервером
				
				// 4й этап: решение по заявке, добавляются поля:
				isApproved: Bool?,
				resolutionMessage: str?,
			}
		  ```
		- Как это должно храниться
			- в бд:
				- Единая таблица с nullable полями, но с набором ограничений (constraints) для гарантии консистентности:
					- ```sql
						-- пример ограничения:
						Status <> 'AcceptedForReview' OR (
							acceptedBy IS NOT NULL AND
							isApproved IS NULL AND
							resolutionMessage IS NULL
						)
					```
			- на бэке
				- Несколько дтошек, по одной на каждый этап, каждая расширяет предыдущую своими полями (чтобы не приходилось каждый раз проверять поля на null)
			- на фронте
				- json с набором полей, соответствующих определенному этапу
				- набор полей можно понять по полю status
				- (полей со значением null быть не должно, пустые поля просто будут отсутствовать)
	- `ExpertApplicationAction
		- ```js
			{
				id: Id, // управляется сервером
				applicationId: Id(ExpertApplication), // управляется сервером
				datetime: IsoDateTime, // управляется сервером
				
				action: ExpertApplicationActionType, // управляется сервером
				other: JSONB? // управляется сервером
			}
		  ```


- /api/v0
	- /auth - логика связанная с авторизацией, представлена в виде контроллеров, а не ресурсов
		- /sendVerificationEmailForRegistration (POST) - отправляет на почту ссылку для регистрации
			- ссылка имеет следующий вид: `{url страницы с регистрацией}?token={access_token}`, токен будет с ролью `with_confirmed_email` и c почтой контексте
			- доступ:
				- для всех
			- тело:
				- `{email: str}`
			- ответы:
				- 204 - No Content
				- 409 - если почта уже занята
				- 422 - если почта не валидна
				- 400/~~404~~ - ошибки параметров
				- ~~401~~/~~403~~ - ошибки входа/доступа
				- 404/405/429/500 - ошибки входа/доступа
		- /register (POST) - создает пользователя с ролью `student`
			- доступ:
				- `with_confirmed_email`
			- эффекты:
				- refresh токен кладется в куки
			- тело:
				- ```js
				  {
					  username: str
					  // 0<символов<256, разрешены латиница, цифры, подчеркивания
					  password: str
					  // достаточно сложный по zxcvbn
					  // (email берется из токена, его передавать не нужно)
				  }
				  ```
			- ответы:
				- 201 -> `{ "access_token": "..." }`
				- 409 - username уже занят
				- 422 - пароль слишком слабый (силу можно проверять через `zxcvbn`) или username не удовлетворяет условиям
				- 400/~~404~~ - ошибки параметров
				- ~~401/403~~ - ошибки входа/доступа
				- 404/405/429/500 - общие
		- /login (POST) - вход по паролю
			- доступ:
				- для всех
			- эффекты:
				- refresh токен кладется в куки
			- тело:
				- ```js
					{
						email: str,
						password: str,
					}
				  ```
			- ответы:
				- 200 -> `{access_token: str}`
				- ~~409~~
				- 422 - неверная почта или пароль (что именно - не сообщается)
				- 429 - ==тут будет особо строгое ограничение по попыткам входа==
				- 400/~~404~~ - ошибки параметров
				- ~~401/403~~ - ошибки входа/доступа
				- 404/405/429/500 - общие
		- /logout (POST) - выходит с устройства, деактивирует refresh и access токен
			- заголовки:
				- refresh токен (передается автоматически)
				- access токен нужен (даже если он устарел - не важно)
			- ответы:
				- 204 No Content
				- ошибок параметров тут быть не может (даже если токены уже истекли, то все равно вернется 204, так просрочить токен это по сути то же самое, что выйти)
				- ~~409~~
				- ~~422~~
				- ~~400/404~~ - ошибки параметров
				- ~~401/403~~ - ошибки входа/доступа
				- 404/405/429/500 - общие
		- /refresh (POST) - обновляет refresh и access токены, отзывает старые
			- заголовки:
				- refresh передается автоматически, access не нужен
			- доступ:
				- не проверяется
			- эффекты:
				- refresh токен кладется в куки
			- ответы:
				- 200 -> `{access_token: str}`
				- 401 - если refresh токен истек
				- ~~409~~
				- ~~422~~
				- ~~400/404~~ - ошибки параметров
				- 401/~~403~~ - ошибки входа/доступа
				- 404/405/429/500 - общие
		- /changePassword (POST)
			- доступ:
				- `logged_in`
			- тело:
				- ```js
					{
						old_password: str,
						new_password: str,
					}
				  ```
			- ответы:
				- ~~409~~
				- 422 - пароль слишком слабый / старый пароль был другим
				- 400/~~404~~ - ошибки параметров
				- 401/~~403~~ - ошибки входа/доступа
				- 404/405/429/500 - общие
		- /sendVerificationEmailForResetPassword (POST) - отправляет на почту ссылку для сброса пароля
			- Отправляется ссылка, которая имеет вид `{url страницы для сброса пароля}?token={access_token}`, токен будет с ролью with_confirmed_email и c почтой контексте
			- доступ:
				- для всех
			- тело:
				- `{email: str}`
			- Ответы:
				- 204
				- ~~409~~
				- 422 - невалидная почта
				- 429 - ==тут тоже жесткое ограничение==
				- 400/404 - ошибки параметров
				- ~~401/403~~ - ошибки входа/доступа
				- 404/405/429/500 - общие
		- /resetPassword (POST)
			- доступ:
				- `with_confirmed_email`
			- тело:
				- `{new_password: str}`
			- ответы:
				- 204
				- ~~409~~
				- 422 - слабый пароль
				- 400/~~404~~ - ошибки параметров
				- 401/403 - ошибки входа/доступа
				- 404/405/429/500 - общие
	
	- /users
		- /{id}/ (GET) - получает пользователя без персональных данных
			- доступ:
				- для всех
			- ответы:
				- 200 ->`User`
				- ~~409~~
				- ~~422~~
				- 400/404 - ошибки параметров
				- ~~401/403~~ - ошибки входа/доступа
				- 404/405/429/500 - общие
		- ?{параметры пагинации} (GET) - получение всех пользователей
			- можно использовать для получения всех админов: `?...&role=Admin`
			- доступ: `superadmin`
				- такой высокий, т.к. у нас пока никому кроме суперадминов просматривать всех пользователей не нужно
				- если станет нужно - ослабим ограничение
			- параметры:
				- `role:str?` - фильтрует по роли, если не указано - не фильтрует
			- ответы:
				- 200 ->`PaginationPage<User>`
				- ~~409~~
				- ~~422~~
				- 400/404 - ошибки параметров
				- 401/403 - ошибки входа/доступа
				- 400/404/422 - пагинация
				- 404/405/429/500 - общие
		- /{id} (PATCH) - редактирование полей
			- доступ:
				- `logged_in`, только на себя
			- тело:
				- JSONPATCH над User без серверных полей
			- ответы:
				- 204
				- 404 - id
				- ~~409~~
				- 422 - если какие то поля невалидны (напр username)
				- 400 - ошибка формата
				- 401/403 - ошибки входа/доступа
				- ~~400/404/422 - пагинация~~
				- 404/405/429/500 - общие
		- /{id}/anonymize (POST) - удаляет все данные пользователя, но сохраняет id в связанных ресурсах
			- ==может все таки заменять id на null или на нулевой id?==
			- доступ:
				- `logged_in`, работает только на себя
			- ответы:
				- 204
				- 404 - id
				- 409 - уже удален
				- ~~422~~
				- 400 - ошибки формата
				- 401/403 - ошибки входа/доступа
				- ~~400/404/422 - пагинация~~				
				- 404/405/429/500 - общие

	- /users/{id}/roles/admin
		- / (PUT) - назначает пользователя админом
			- доступ:
				- `superadmin`
			- ответы:
				- 204
				- 404 - из-за id
				- 409 - уже админ
				- ~~422~~
				- 400 - ошибки формата
				- 401/403 - ошибки входа/доступа
				- ~~400/404/422 - пагинация~~
				- 404/405/429/500 - общие
		- / (DELETE) - отозвать админку
			- доступ:
				- `superadmin`
			- ответы:
				- 204
				- 404 - из-за id
				- 409 - уже не админ
				- ~~422~~
				- 400 - из-за id
				- 401/403 - ошибки входа/доступа
				- ~~400/404/422 - пагинация~~
				- 404/405/429/500 - общие

	- /courses
		- / (POST) - создает курс
			- доступ:
				- `admin`
			- тело:
				- `Course`, но без серверных полей
			- ответы:
				- 201 -> `Course`
				- ~~404~~
				- ~~409~~
				- ~~422~~
				- 400 - тело
				- 401/403 - ошибки входа/доступа
				- ~~400/404/422 - пагинация~~
				- 404/405/429/500 - общие
		- ?{параметры пагинации} (GET) - получить список курсов
			- доступ:
				- для всех
			- ответы:
				- 200 -> `PaginationPage<Course>`
				- ~~404~~
				- ~~409~~
				- ~~422~~
				- ~~400~~
				- ~~401/403 - ошибки входа/доступа~~
				- 400/404/422 - пагинация
				- 404/405/429/500 - общие
		- /{id} (GET) - получить курс
			- доступ:
				- для всех
			- ответы:
				- 200 -> `Course`
				- 404 - id
				- ~~409~~
				- ~~422~~
				- 400 - id
				- ~~401/403 - ошибки входа/доступа~~
				- ~~400/404/422 - пагинация~~
				- 404/405/429/500 - общие
		- /{id} (PATCH) - редактирует курс
			- доступ:
				- `admin
			- тело:
				- JSONPATCH над Course без серверных полей
			- ответы:
				- 204
				- 404 - id
				- ~~409~~
				- ~~422~~
				- 400 - id, тело
				- 401/403 - ошибки входа/доступа
				- ~~400/404/422 - пагинация~~
				- 404/405/429/500 - общие
		- /{id} (DELETE) - удаляет курс и отписывает всех пользователей от него
			- доступ:
				- `admin`
			- ответы:
				- 204
				- 404 - id
				- ~~409~~
				- ~~422~~
				- 400 - id
				- 401/403 - ошибки входа/доступа
				- ~~400/404/422 - пагинация~~
				- 404/405/429/500 - общие

	- /events
		- / (POST) - создает евент
			- доступ:
				- `admin`
			- тело:
				- `Event`, без серверных полей
			- ответы:
				- 201 -> `Event`
				- ~~404~~
				- ~~409~~
				- ~~422~~
				- 400 - тело
				- 401/403 - ошибки входа/доступа
				- ~~400/404/422 - пагинация~~
				- 404/405/429/500 - общие
		- ?{параметры пагинации} (GET) - получить список евентов
			- доступ:
				- для всех
			- ответы:
				- 200 -> `PaginationPage<Event>`
				- ~~404~~
				- ~~409~~
				- ~~422~~
				- ~~400~~
				- 401/403 - ошибки входа/доступа
				- 400/404/422 - пагинация
				- 404/405/429/500 - общие
		- /{id} (GET) - получить евент
			- доступ:
				- для всех
			- ответы:
				- ок
					- 200 -> `Course`
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ~~ошибки входа/доступа - 401/403~~
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500
		- /{id} (PATCH) - редактирует евент
			- доступ:
				- `admin`
			- тело:
				- JSONPATCH над Event без серверных полей
			- ответы:
				- ок
					- 204
				- ошибки параметров (id, тело)
					- 400 - id, тело
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500
		- /{id} (DELETE) - удаляет евент и отписывает всех пользователей от него
			- доступ:
				- `admin`
			- ответы:
				- ок
					- 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500

	- /{coursesRegistrations/eventsRegistrations}
		- / (POST) - записывает пользователя на курс/евент
			- доступ:
				- `student`, который указан в теле
			- тело:
				- `EventRegistration/CourseRegistration` без серверных полей
			- ответы:
				- ок
					- 201 -> `EventRegistration/CourseRegistration`
				- ошибки параметров (тело: user, event)
					- 400 - тело
					- 404 - user, event
					- 409 - уже есть запись
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации ~~
					- ~~400/404/422~~
				- общие
					- 404/405/429/500
		- ?{параметры пагинации}&userId={userId}&{courseId/eventId}={{courseId}/{eventId}} (GET)
			- доступ:
				- Если указан `userId`, то доступно только этому юзеру
				- Если `userId` не указан, то доступно только админам
			- параметры (кроме пагинации):
				- `userId: Id(User)?` - получение регистраций данного юзера
				- `courseId={courseId}` или `eventId={eventId}` - получений регистраций на данное мероприятие
				- указать оба эти параметра можно, хоть и не особо осмысленно - вернется регистрация данного пользователя на данное мероприятие (или пустая коллекция, если он не зареган)
			- ответы:
				- ок
					- 200 -> `PaginationPage<EventRegistration/CourseRegistration>`
				- ошибки параметров (userId, courseId/eventId)
					- 400 - userId, courseId/eventId
					- 404 - userId, courseId/eventId
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ошибки пагинации
					- 400/404/422
				- общие
					- 404/405/429/500
		- /{id} (GET) - получает запись
			- доступ:
				- `student`, кому принадлежит эта запись
			- ответы:
				- ок
					- 200 -> `EventRegistration/CourseRegistration`
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации~~
					- ~~400/404/422~~
				- общие
					- 404/405/429/500
		- /{id} (DELETE) - отменить запись
			- доступ:
				- `student`, кому принадлежит эта запись
			- ответы:
				- ок
					- 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации~~
					- ~~400/404/422~~
				- общие
					- 404/405/429/500

	- /posts
		- / (POST) - создание поста
			- доступ:
				- `admin`
			- тело:
				- `Post` без серверных полей
			- ответы:
				- ок
					- 201 -> `Post`
				- ошибки параметров (тело: title, description, status)
					- 400 - тело
					- ~~404~~
					- ~~409~~
					- 422 - title слишком длинный
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации~~
					- ~~400/404/422~~
				- общие
					- 404/405/429/500
		- ?{параметры пагинации}&mine={isMine} (GET) - получение постов
			- доступ:
				- если mine=true: `admin`
				- иначе: для всех
			- параметры:
				- пагинация
				- mine: `bool?`
					- если true - возвращает свои посты (в т.ч. скрытые)
					- по умолчанию - false
			- ответы:
				- ок
					- 200 -> `PaginationPage<Post>`
				- ошибки параметров (isMine)
					- 400 - isMine
					- ~~404~~
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ошибки пагинации
					- 400/404/422
				- общие
					- 404/405/429/500
		- /{id} (GET) - получение поста по id
			- доступ:
				- для публичных постов - для всех
				- для скрытых постов - `admin`, который автор поста
			- ответы:
				- ок
					- 200 -> `Post`
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации~~
					- ~~400/404/422~~
				- общие
					- 404/405/429/500
		- /{id} (PATCH) - обновление поста
			- доступ:
				- `admin`, который автор поста
			- тело:
				- JSONPATCH над Post без серверных полей
			- ответы:
				- ок
					- 200 -> `Post`
				- ошибки параметров (id, тело: title,description,status)
					- 400 - id, тело
					- 404 - id
					- ~~409~~
					- 422 - title слишком длинный
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации~~
					- ~~400/404/422~~
				- общие
					- 404/405/429/500
		- /{id} (DELETE) - удаление поста
			- доступ:
				- `admin`, который автор поста
			- ответы:
				- ок
					- 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации~~
					- ~~400/404/422~~
				- общие
					- 404/405/429/500

	- /users/{id}/notifications
		- ?{параметры пагинации} (GET) - получить уведомления пользователя
			- доступ:
				- `logged_in` пользователь с данным id
			- параметры:
				- пагинации
			- ответы:
				- ок
					- 200 -> `PaginationPage<Notification>`
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ошибки пагинации
					- 400/404/422
				- общие
					- 404/405/429/500
		- /{id} (GET) - получить уведомление
			- доступ:
				- `logged_in` пользователь с данным id
			- ответы:
				- ок
					- 200 -> `Notification`
				- ошибки параметров (userId, notificationId)
					- 400 - userId, notificationId
					- 404 - userId, notificationId
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации: 400/404/422~~
				- общие: 404/405/429/500
		- /{id}/markAsRead (PATCH) - пометить прочитанным
			- доступ:
				- `logged_in` пользователь с данным id
			- ответы:
				- ок
					- 204
				- ошибки параметров (userId, notificationId)
					- 400 - userId, notificationId
					- 404 - userId, notificationId
					- 409 - уже прочитано
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации: 400/404/422~~
				- общие: 404/405/429/500

	- /expertApplications
		- про заявки
			- этапы обработки заявки можно представить как состояния стейт машины
				- схема
					- ![схема](https://i.ibb.co/svfDStbt/image.png)
			- перед вынесением решения по заявке ее нужно взять на рассмотрение
				- чтобы 2 админа одновременно не обрабатывали одну и ту же заявку
			- админ не может держать заявку на рассмотрении более чем N минут (N по умолчанию будет 60)
			- все действия с заявкой обратимые
				- чтобы дать возможность исправлять ошибки
			- все действия с заявкой сохраняются в истории
				- чтобы не было ситуации, когда пользователь пишет в поддержку "почему у меня вчера был статус эксперта, а сейчас его нет", а поддержка смотрит в базу, а там только текущее состояние и они ничего не могут ему ответить
			- у пользователя в лк отображается именно история
				- чтобы он понимал, что происходит с его заявкой
			- по дополнительным полям элементов истории вроде ни сортировать ни фильтровать не нужно, поэтому они в JSONB
		- / (POST) - создать заявку (и сохранить нужный экшон в истории)
			- доступ:
				- `student`
			- тело:
				- `ExpertApplication(Created)`, без серверных полей
			- ответы:
				- ок
					- 201 -> `ExpertApplication(Created)`
				- ошибки параметров (тело)
					- 400 - тело
					- ~~404~~
					- 409 - уже есть заявка, по которой не вынесено решение или если уже эксперт
					- ~~422~~
				- ошибки входа/доступа
					- 401/~~403~~
				- ~~ошибки пагинации: 400/404/422~~
				- общие: 404/405/429/500
		- ?{параметры пагинации}&createdBy={...}&status={...}&acceptedBy={...} (GET) - получить заявки
			- доступ:
				- админ может смотреть только отправленные заявки, а пользователь только свои:
				- `admin` => `status` больше или равен `Sent`
				- `student` => должно быть указано `createdBy={id этого юзера}`
			- параметры:
				- пагинация
				- `createdBy: Id(User)?` - фильтрация по пользователю
					- чтобы пользователь смотрел свои заявки
				- `status: ExpertApplicationStatus?` - фильтрация по статусу
					- чтобы админ смотрел все отправленные заявки
				- `acceptedBy: Id(User)?` - фильтрация по взявшему
					- чтобы админ посмотрел, какие заявки он взял
			- ответы:
				- ок
					- 200 -> `PaginationPage<ExpertApplication>`
				- ошибки параметров (createdBy, status, acceptedBy)
					- 400 - createdBy, status, acceptedBy
					- 404 - createdBy, acceptedBy
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ошибки пагинации: 400/404/422
				- общие: 404/405/429/500
		- /{id} (GET) - получить заявку
			- доступ:
				- `student` - автор заявки
				- и `admin`, если она была отправлена
			- ответы:
				- ок
					- 200 -> `ExpertApplication`
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~409~~
					- ~~422~~
				- ошибки входа/доступа
					- 401/403
				- ~~ошибки пагинации: 400/404/422~~
				- общие: 404/405/429/500
		- /{id} (PATCH) - редактировать заявку
			- доступ:
				- `student` - автор заявки
			- тело:
				- JSONPATCH над `ExpertApplication(Created)` без серверных полей
			- ответы:
				- ок
					- 200 -> `ExpertApplication`
				- ошибки параметров (id, тело)
					- 400 - id, тело
					- 404 - id
					- 409 - если status выше или равен Accepted
					- ~~422~~
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500
		- /{id} (DELETE) - удалить заявку и ее историю
			- доступ:
				- `student` - автор заявки
			- ответы:
				- ок
					- 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- 409 - если status выше или равен Accepted
					- ~~422~~
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500
	
		- /{id}/send (POST) - отправить (и сохранить нужный экшон в истории)
			- доступ:
				- `student` (автор)
			- ответы:
				- ок
					- 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~422~~
				- логические ошибки - 409 - если статус не Created
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500
		- /{id}/cancelSending (POST) - отозвать заявку (и сохранить нужный экшон в истории)
			- доступ:
				- `student` (автор)
			- ответы:
				- ок
					- 2xx -> тело
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~422~~
				- логические ошибки - 409 - если статус не Sent
				- ошибки входа/доступа - 401/403
				- ошибки пагинации - 400/404/422
				- общие - 404/405/429/500
		- /{id}/accept (POST) - взять на рассмотрение (и сохранить нужный экшон в истории)
			- доступ:
				- любой `admin`, если статус >= Sent
			- %% на будущее: эффекты: заводит таймер на N минут, после которого произойдет /cancelAcceptance, возвращать 200 -> `{bookedFor: int (minutes)}` %%
			- ответы:
				- ок - 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~422~~
				- логические ошибки - 409 - если статус не Sent
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500
		- /{id}/cancelAcceptance (POST) - отменить рассмотрение (и сохранить нужный экшон в истории)
			- доступ:
				- `admin`, который взял и если статус >= Sent
			- ответы:
				- ок - 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~422
				- логические ошибки - 409 - если статус не AcceptedForReview
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500
		- /{id}/review (POST) - вынести решение по заявке (и сохранить нужный экшон в истории)
			- доступ:
				- `admin`, который взял и если статус >= Sent
			- эффекты
				- отправляет уведомление пользователю о том, что заявка рассмотрена
				- если заявка одобрена - делает пользователя экспертом
			- тело:
				- не серверные поля ExpertApplication, которые добавляются на этапе решения по заявке
			- ответы:
				- ок - 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~422
				- логические ошибки - 409 - если статус не AcceptedForReview
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500
		- /{id}/cancelReview (POST) - отменить решение по заявке (и сохранить нужный экшон в истории)
			- доступ:
				- любой `admin` и если статус >= Sent
			- эффекты:
				- отправляет уведомление о том, что решение по заявке отменено
				- снимает с пользователя статус эксперта, если он был
			- ответы:
				- ок - 204
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~422
				- логические ошибки - 409
					- если статус не Reviewed или если пользователь уже подал новую заявку (у одного пользователя не должно быть одновременно подано несколько не закрытых заявок т.к. возникают странные конфликтные ситуации)
				- ошибки входа/доступа - 401/403
				- ~~ошибки пагинации - 400/404/422~~
				- общие - 404/405/429/500

	- /expertApplications/{id}/history (readonly ресурс)
		- ?{параметры пагинации} (GET) - посмотреть историю
			- доступ:
				- выбранный `student`
			- ответы:
				- ок - 200 -> `PaginationPage<ExpertApplicationAction>
				- ошибки параметров (id)
					- 400 - id
					- 404 - id
					- ~~422~~
				- ~~логические ошибки - 409~~
				- ошибки входа/доступа - 401/403
				- ошибки пагинации - 400/404/422
				- общие - 404/405/429/500




